# Полная сборка приложения Share Your Code. Инструкция по развёртыванию

## Что это?

Цель данного приложения - создать платформу, участники которой смогут выклыдывать свой код, исполнять его, а также давать оценки.

## Требования к системе

Linux (тестировалось на Debian), Windows. В случае Windows компиляция работать не будет (т.к. участвует bash-скрипт).

## Требования к ПО

1. NodeJS (разработка была на версии 16) - интерпритатор javascript. Ссылка на установку: https://nodejs.org/en/
2. npm - сборщик пакетов javascript (поставляется вместе с NodeJS)
3. Docker (версия 3+) - инструмент контейнеризации (в данном проекте необходим для Базы данных, а также для исполнения кода пользователей). Ссылка на установку: https://www.docker.com/products/docker-desktop/

Вроде бы всё.

## Инструкция по сборке. Клонирование репозитория.

### Клоинрование репозитория
$ git clone https://github.com/ponchik009/ShareYourCode

### Переход в папку проекта
$ cd ShareYourCode

## Инструкция по сборке. Сборка фронтенда.

### Переход в папку фронтенда
$ cd frontend

### Установка пакетов
$ npm install

### Найтрока конфигурации
<p>В корне фронтенда создаем файл .env</p>
<p>Содержимое файла:</p>
<ul>
  <li>PORT=<порт, на котором будет запускаться приложение (для разрабтки)></li>
  <li>REACT_APP_URL=< url, по которому будет доступно наше приложение (например, https://syc.tucana.org)></li>
  <li>REACT_APP_API_URL=< url до апи (если фронтенд соединяется с беком, то указываем /api)></li>
</ul>

<p>Примечание: если бекенд и фронтенд мы разворачиваем отдельно друг от друга (этот сценарий рассмотрен не будет), то в переменной REACT_APP_API_URL нужно указывать полный путь до api (например, https://syc.tucana.org/api) 

### Сборка статических файлов
$ npm run build

###  Итого
После сборки, в корне фронтенда будет находиться папка <b>build</b> с собранным проектом

## Инструкция по сборке. Сборка бекенда (всего проекта).

### Переход в папку бекенда
$ cd ../backend

### Установка пакетов
$ npm install

### Найтрока конфигурации
<p>В корне проекта бекенда файл .env</p>
<p>Содержимое файла:</p>
<ul>
  <li>PORT=<порт, на котром будет висеть приложение></li>
  <li>POSTRES_HOST=<сеть, в которой находится база данных (в нашем случае localhost)></li>
  <li>POSTGRES_PORT=<порт, на котором будет висеть база данных (например, 5432)></li>
  <li>POSTGRES_USER=<пользователь базы данных (например, postgres)></li>
  <li>POSTGRES_PASSWORD=<пароль к пользователю базы данных (например, admin)></li>
  <li>POSTGRES_DB=<название базы данных (например, syc)></li>
  <li>POSTGRES_DATA_DIR=<путь к директории, в которой контейнер будет хранить данные постгреса на хостовой машине (например, /data/postgres)></li>
  <li>PGADMIN_DEFAULT_EMAIL=< email для использования pgadmin (например, admin@admin.com)></li>
  <li>PGADMIN_DEFAULT_PASSWORD=<пароль для pgadmin (например, admin)></li>
  <li>PGADMIN_PORT=<порт для pgadmin (например, 9000)></li>
  <li>PGADMIN_DATA_DIR=<путь к директории, в которой контейнер будет хранить данные постгреса на хостовой машине (например, /data/pgadmin)></li>
  <li>JWT_SECRET = <секретный ключ для jwt-токена (например, 'aboba228')></li>
  <li>JWT_EXPIRATION_TIME = <время жизни jwt-токена (например, '31536000' - год)></li>
  <li>SCRIPT_PATH=<путь до скрипта, компилирующего код (изначально он находится в корне, указываем "./run.sh")></li>
  <li>TMP_DIR=<путь к директории для создания промежуточных файлов во время компиляции (например, "/etc/tmp")></li>
</ul>

### Запуск контейнера с базой данных и pgadmin
$ docker-compose up &

<p>Примечание: возможно, после этой команды надо будет открыть новое окно терминала</p>
<p>Примечание 2: возможно, придется вручную создать базу данных с именем, указанным в .env файле (это можно сделать с помощью удобного интерфейса pgadmin)</p>
<p>Примечание 3: если вы разворачиваете с готовой субд и новый контейнер с базой вам не нужен, пропускаем этот шаг.</p>

###  Добавление фронтенда
<p>Берем папку <b>build</b>, которую мы получили в ходе сборки фронтенда, и кладем ее в корень бекенда, переименовав на <b>client</b> (особенности проекта)</p>
$ cp -r ../frontend/build client

### Запуск приложения
$ npm run start:dev

### Итого
После выполнения всех вышеперечисленных действий, на указанном порту будет запущено приложение.
